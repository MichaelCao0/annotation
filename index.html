<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HQ1K å›¾åƒç¼–è¾‘åå¥½æ ‡æ³¨ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #10b981, #059669);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ä¸ªäººä¿¡æ¯å’Œæ ‡æ³¨æ ‡å‡†æ ·å¼ */
        .user-info-section, .guidelines-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 4px solid #4f46e5;
        }

        .user-info-section h3, .guidelines-section h3 {
            color: #1f2937;
            margin-bottom: 25px;
            font-size: 1.5em;
            text-align: center;
        }

        .user-info-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .start-btn, .guidelines-btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
        }

        .start-btn:hover, .guidelines-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }

        .guidelines-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .intro {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid #e5e7eb;
        }

        .intro p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .evaluation-criteria h4, .rating-scale h4 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .criterion {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .criterion h5 {
            color: #4f46e5;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .criterion p {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
        }

        .rating-scale {
            background: white;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-bottom: 25px;
        }

        .scale-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .scale-item {
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
            border: 2px solid transparent;
        }

        .scale-item.strong-a {
            background: #fee2e2;
            color: #dc2626;
            border-color: #fecaca;
        }

        .scale-item.strong-b {
            background: #ede9fe;
            color: #7c3aed;
            border-color: #ddd6fe;
        }

        .scale-item.slight-a {
            background: #fed7aa;
            color: #f97316;
            border-color: #fdba74;
        }

        .scale-item.slight-b {
            background: #dbeafe;
            color: #3b82f6;
            border-color: #93c5fd;
        }

        .scale-item.equal-good {
            background: #d1fae5;
            color: #10b981;
            border-color: #a7f3d0;
        }

        .scale-item.equal-bad {
            background: #f3f4f6;
            color: #6b7280;
            border-color: #d1d5db;
        }

        .guidelines-actions {
            text-align: center;
            margin-top: 30px;
        }

        /* ä¸‰æ å¸ƒå±€ */
        .annotation-area {
            display: grid;
            grid-template-columns: 300px 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .guidelines-panel {
            display: flex;
            flex-direction: column;
        }

        .content-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .prompt-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            border-left: 4px solid #4f46e5;
        }

        .prompt-section h3 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .original-image {
            text-align: center;
            margin-bottom: 25px;
        }

        .original-image img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .prompt-text {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            line-height: 1.6;
        }

        .prompt-text .english {
            color: #374151;
            margin-bottom: 15px;
            font-style: italic;
        }

        .prompt-text .chinese {
            color: #1f2937;
            font-weight: 500;
        }

        .comparison-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .images-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .image-option {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .image-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .image-option.selected {
            border-color: #4f46e5;
            background: #eef2ff;
        }

        .image-option h4 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .image-option img {
            max-width: 100%;
            max-height: 350px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .preference-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .preference-btn {
            padding: 15px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-align: center;
        }

        .preference-btn:hover {
            border-color: #4f46e5;
            color: #4f46e5;
        }

        .preference-btn.selected {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }

        .preference-btn.strong-a {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }

        .preference-btn.slight-a {
            background: #f97316;
            color: white;
            border-color: #f97316;
        }

        .preference-btn.equal-good {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .preference-btn.equal-bad {
            background: #6b7280;
            color: white;
            border-color: #6b7280;
        }

        .preference-btn.slight-b {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .preference-btn.strong-b {
            background: #7c3aed;
            color: white;
            border-color: #7c3aed;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #e5e7eb;
        }

        .nav-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-btn.prev {
            background: #6b7280;
            color: white;
        }

        .nav-btn.next {
            background: #10b981;
            color: white;
        }

        .nav-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            text-align: center;
            color: #6b7280;
            font-weight: 500;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #6b7280;
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        /* æ ‡æ³¨é¡µé¢å·¦ä¾§æ ‡å‡†è¯´æ˜ - ç‹¬ç«‹æ¡† */
        .annotation-guidelines-box {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            border-radius: 16px;
            padding: 25px;
            border: 2px solid #10b981;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
            position: relative;
            overflow: hidden;
        }

        .annotation-guidelines-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669, #047857);
        }

        .annotation-guidelines-box h3 {
            color: #065f46;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(16, 185, 129, 0.1);
        }

        .guidelines-compact {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .criterion-compact {
            background: rgba(255, 255, 255, 0.9);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #d1fae5;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .criterion-compact:hover {
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
            transform: translateY(-2px);
            border-color: #10b981;
        }

        .criterion-compact h5 {
            color: #047857;
            margin-bottom: 8px;
            font-size: 1em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .criterion-compact p {
            color: #374151;
            font-size: 13px;
            line-height: 1.6;
            margin: 0;
            font-weight: 500;
        }

        @media (max-width: 1024px) {
            .annotation-area {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .guidelines-panel {
                order: 1;
            }

            .content-panel {
                order: 2;
            }

            .comparison-section {
                order: 3;
            }
            
            .images-row {
                grid-template-columns: 1fr;
            }
            
            .preference-buttons {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .criteria-grid, .scale-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .annotation-guidelines-box {
                padding: 15px;
            }

            .criterion-compact {
                padding: 12px;
            }

            .criterion-compact h5 {
                font-size: 0.9em;
            }

            .criterion-compact p {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HQ1K å›¾åƒç¼–è¾‘åå¥½æ ‡æ³¨ç³»ç»Ÿ</h1>
            <p>è¯·æ ¹æ®ç¼–è¾‘æŒ‡ä»¤çš„æ‰§è¡Œæ•ˆæœï¼Œå¯¹ä¸¤å¼ ç¼–è¾‘åçš„å›¾ç‰‡è¿›è¡Œåå¥½è¯„ä¼°</p>
        </div>

        <div class="content">
            <!-- ä¸ªäººä¿¡æ¯å¡«å†™åŒºåŸŸ -->
            <div id="userInfoSection" class="user-info-section">
                <h3>ä¸ªäººä¿¡æ¯</h3>
                <div class="user-info-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userName">å§“åï¼š</label>
                            <input type="text" id="userName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                        </div>
                        <div class="form-group">
                            <label for="userAge">å¹´é¾„ï¼š</label>
                            <input type="number" id="userAge" min="18" max="80" placeholder="å¹´é¾„" required>
                        </div>
                        <div class="form-group">
                            <label for="userGender">æ€§åˆ«ï¼š</label>
                            <select id="userGender" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="male">ç”·</option>
                                <option value="female">å¥³</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userEducation">æ•™è‚²èƒŒæ™¯ï¼š</label>
                            <select id="userEducation" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="highschool">é«˜ä¸­åŠä»¥ä¸‹</option>
                                <option value="bachelor">æœ¬ç§‘</option>
                                <option value="master">ç¡•å£«</option>
                                <option value="phd">åšå£«</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userExperience">å›¾åƒå¤„ç†ç»éªŒï¼š</label>
                            <select id="userExperience" required>
                                <option value="">è¯·é€‰æ‹©</option>
                                <option value="none">æ— ç»éªŒ</option>
                                <option value="basic">åŸºç¡€ä½¿ç”¨</option>
                                <option value="intermediate">ä¸­çº§æ°´å¹³</option>
                                <option value="advanced">ä¸“ä¸šæ°´å¹³</option>
                            </select>
                        </div>
                    </div>
                    <button id="startAnnotationBtn" class="start-btn">å¼€å§‹æ ‡æ³¨</button>
                </div>
            </div>

            <!-- æ ‡æ³¨æ ‡å‡†è¯´æ˜ -->
            <div id="guidelinesSection" class="guidelines-section" style="display: none;">
                <h3>æ ‡æ³¨æ ‡å‡†</h3>
                <div class="guidelines-content">
                    <div class="intro">
                        <p><strong>è¿™æ˜¯ä¸€ä»½åå¥½æ”¶é›†é—®å·ï¼Œä½ å°†çœ‹åˆ°ï¼š</strong></p>
                        <p>ä¸€å¼ åŸå›¾ã€ä¸€æ®µå›¾ç‰‡ç¼–è¾‘æŒ‡ä»¤ã€ä¸¤å¼ ç¼–è¾‘åçš„å›¾ç‰‡ã€‚</p>
                    </div>
                    
                    <div class="evaluation-criteria">
                        <h4>è¯„åˆ¤ç›®æ ‡ï¼š</h4>
                        <div class="criteria-grid">
                            <div class="criterion">
                                <h5>ğŸ“‹ å¯¹é½åº¦</h5>
                                <p>ç¼–è¾‘åçš„å›¾ç‰‡æ˜¯å¦å‡†ç¡®åœ°æŒ‰ç…§ç»™å®šçš„ç¼–è¾‘æŒ‡ä»¤è¿›è¡Œä¿®æ”¹ã€‚åˆ¤æ–­æ—¶éœ€è¦çœ‹ä¿®æ”¹æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œæ˜¯å¦åœ¨å›¾åƒä¸­å®ç°äº†ç¼–è¾‘æ„å›¾ã€‚</p>
                            </div>
                            <div class="criterion">
                                <h5>ğŸ”§ åˆç†æ€§</h5>
                                <p>å›¾åƒä¸­çš„ä¿®æ”¹æ˜¯å¦ç¬¦åˆç‰©ç†æˆ–è¯­ä¹‰ä¸Šçš„å¸¸ç†ã€‚å…³æ³¨æ˜¯å¦å­˜åœ¨ç‰©ç†ä¸å¯èƒ½çš„æƒ…å†µã€è¯­ä¹‰ä¸é€šçš„æƒ…å¢ƒã€è§†è§‰ä¼ªå½±ã€ç•¸å˜æˆ–æ–­è‚¢ç­‰é—®é¢˜ã€‚</p>
                            </div>
                            <div class="criterion">
                                <h5>ğŸ¨ ç¾å­¦</h5>
                                <p>è¯„ä¼°æ•´ä½“çš„è§†è§‰æ•ˆæœï¼ŒåŒ…æ‹¬æ„å›¾æ˜¯å¦åˆç†ï¼Œé¢œè‰²æ­é…ï¼Œå›¾åƒæ¸…æ™°åº¦ï¼Œé£æ ¼ç»Ÿä¸€æ€§ç­‰ã€‚è€ƒè™‘å›¾åƒçš„å¸å¼•åŠ›å’Œåè°ƒæ€§ã€‚</p>
                            </div>
                            <div class="criterion">
                                <h5>â­ æ€»è¯„</h5>
                                <p>åŸºäº"å¯¹é½åº¦""åˆç†æ€§"å’Œ"ç¾å­¦"ä¸‰ä¸ªç»´åº¦çš„ç»¼åˆè¯„åˆ¤ï¼Œå¾—å‡ºæœ€ç»ˆçš„ç»¼åˆåˆ¤æ–­ã€‚</p>
                            </div>
                        </div>
                    </div>

                    <div class="rating-scale">
                        <h4>è¯„åˆ†æ ‡å‡†ï¼š</h4>
                        <p>æ¯ä¸ªç»´åº¦éƒ½åšä¸€æ¬¡å¯¹æ¯”åˆ¤æ–­å¹¶æ ‡è®°"å¥½å¤šå°‘"ï¼š</p>
                        <div class="scale-options">
                            <div class="scale-item strong-a">1. A æ˜æ˜¾æ›´å¥½</div>
                            <div class="scale-item strong-b">2. B æ˜æ˜¾æ›´å¥½</div>
                            <div class="scale-item slight-a">3. A ç•¥å¥½</div>
                            <div class="scale-item slight-b">4. B ç•¥å¥½</div>
                            <div class="scale-item equal-good">5. A å’Œ B ä¸€æ ·å¥½</div>
                            <div class="scale-item equal-bad">6. A å’Œ B ä¸€æ ·å·®</div>
                        </div>
                    </div>

                    <div class="guidelines-actions">
                        <button id="hideGuidelinesBtn" class="guidelines-btn">æˆ‘å·²äº†è§£ï¼Œå¼€å§‹æ ‡æ³¨</button>
                    </div>
                </div>
            </div>

            <div class="progress-bar" id="progressSection" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="loadingDiv" class="loading">
                <h3>æ­£åœ¨åŠ è½½æ•°æ®...</h3>
                <p>è¯·ç¨å€™</p>
            </div>

            <div id="errorDiv" class="error" style="display: none;">
                <h3>åŠ è½½å¤±è´¥</h3>
                <p id="errorMessage"></p>
            </div>

            <div id="annotationArea" class="annotation-area" style="display: none;">
                <!-- å·¦ä¾§æ ‡æ³¨æ ‡å‡†ç‹¬ç«‹é¢æ¿ -->
                <div class="guidelines-panel">
                    <div class="annotation-guidelines-box">
                        <h3>ğŸ“ æ ‡æ³¨æ ‡å‡†</h3>
                        <div class="guidelines-compact">
                            <div class="criterion-compact">
                                <h5>ğŸ“‹ å¯¹é½åº¦</h5>
                                <p>ç¼–è¾‘åçš„å›¾ç‰‡æ˜¯å¦å‡†ç¡®åœ°æŒ‰ç…§ç»™å®šçš„ç¼–è¾‘æŒ‡ä»¤è¿›è¡Œä¿®æ”¹ã€‚åˆ¤æ–­æ—¶éœ€è¦çœ‹ä¿®æ”¹æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œæ˜¯å¦åœ¨å›¾åƒä¸­å®ç°äº†ç¼–è¾‘æ„å›¾ã€‚</p>
                            </div>
                            <div class="criterion-compact">
                                <h5>ğŸ”§ åˆç†æ€§</h5>
                                <p>å›¾åƒä¸­çš„ä¿®æ”¹æ˜¯å¦ç¬¦åˆç‰©ç†æˆ–è¯­ä¹‰ä¸Šçš„å¸¸ç†ã€‚å…³æ³¨æ˜¯å¦å­˜åœ¨ç‰©ç†ä¸å¯èƒ½çš„æƒ…å†µã€è¯­ä¹‰ä¸é€šçš„æƒ…å¢ƒã€è§†è§‰ä¼ªå½±ã€ç•¸å˜æˆ–æ–­è‚¢ç­‰é—®é¢˜ã€‚</p>
                            </div>
                            <div class="criterion-compact">
                                <h5>ğŸ¨ ç¾å­¦</h5>
                                <p>è¯„ä¼°æ•´ä½“çš„è§†è§‰æ•ˆæœï¼ŒåŒ…æ‹¬æ„å›¾æ˜¯å¦åˆç†ï¼Œé¢œè‰²æ­é…ï¼Œå›¾åƒæ¸…æ™°åº¦ï¼Œé£æ ¼ç»Ÿä¸€æ€§ç­‰ã€‚è€ƒè™‘å›¾åƒçš„å¸å¼•åŠ›å’Œåè°ƒæ€§ã€‚</p>
                            </div>
                            <div class="criterion-compact">
                                <h5>â­ æ€»è¯„</h5>
                                <p>åŸºäº"å¯¹é½åº¦""åˆç†æ€§"å’Œ"ç¾å­¦"ä¸‰ä¸ªç»´åº¦çš„ç»¼åˆè¯„åˆ¤ï¼Œå¾—å‡ºæœ€ç»ˆçš„ç»¼åˆåˆ¤æ–­ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¸­é—´åŸå§‹å›¾ç‰‡å’Œç¼–è¾‘æŒ‡ä»¤é¢æ¿ -->
                <div class="content-panel">
                    <div class="prompt-section">
                        <h3>åŸå§‹å›¾ç‰‡</h3>
                        <div class="original-image">
                            <img id="originalImage" src="" alt="åŸå§‹å›¾ç‰‡">
                        </div>
                        
                        <h3>ç¼–è¾‘æŒ‡ä»¤</h3>
                        <div class="prompt-text">
                            <div class="english" id="englishPrompt"></div>
                            <div class="chinese" id="chinesePrompt"></div>
                        </div>
                    </div>
                </div>

                <div class="comparison-section">
                    <h3>è¯·é€‰æ‹©æ‚¨è®¤ä¸ºæ›´å¥½çš„ç¼–è¾‘ç»“æœ</h3>
                    <div class="images-row">
                        <div class="image-option" id="imageA">
                            <h4>å›¾ç‰‡ A</h4>
                            <img id="imageA_img" src="" alt="ç¼–è¾‘ç»“æœA">
                        </div>
                        <div class="image-option" id="imageB">
                            <h4>å›¾ç‰‡ B</h4>
                            <img id="imageB_img" src="" alt="ç¼–è¾‘ç»“æœB">
                        </div>
                    </div>

                    <div class="preference-buttons">
                        <button class="preference-btn" data-preference="strong_a">1. A æ˜æ˜¾æ›´å¥½</button>
                        <button class="preference-btn" data-preference="strong_b">2. B æ˜æ˜¾æ›´å¥½</button>
                        <button class="preference-btn" data-preference="slight_a">3. A ç•¥å¥½</button>
                        <button class="preference-btn" data-preference="slight_b">4. B ç•¥å¥½</button>
                        <button class="preference-btn" data-preference="equal_good">5. A å’Œ B ä¸€æ ·å¥½</button>
                        <button class="preference-btn" data-preference="equal_bad">6. A å’Œ B ä¸€æ ·å·®</button>
                    </div>
                </div>
            </div>

            <div class="navigation" id="navigationArea" style="display: none;">
                <button class="nav-btn prev" id="prevBtn">ä¸Šä¸€å¼ </button>
                <div class="status">
                    <span id="currentIndex">1</span> / <span id="totalCount">0</span>
                </div>
                <button class="nav-btn next" id="nextBtn">ä¸‹ä¸€å¼ </button>
            </div>
        </div>
    </div>

    <script>
        class AnnotationInterface {
            constructor() {
                this.currentIndex = 0;
                this.annotations = {};
                this.data = [];
                this.userInfo = {};
                this.init();
            }

            async init() {
                try {
                    await this.loadData();
                    this.setupEventListeners();
                    this.showUserInfoForm();
                } catch (error) {
                    this.showError('æ•°æ®åŠ è½½å¤±è´¥: ' + error.message);
                }
            }

            async loadData() {
                try {
                    // ä»APIåŠ è½½æ•°æ®
                    const response = await fetch('/api/dataset/items?per_page=1000');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    this.data = result.items.map(item => ({
                        id: item.id,
                        originalImage: `/images/${item.original_image}`,
                        imageA: `/images/${item.image_a}`,
                        imageB: `/images/${item.image_b}`,
                        englishPrompt: item.english_prompt,
                        chinesePrompt: item.chinese_prompt
                    }));
                    
                    // åŠ è½½å·²ä¿å­˜çš„æ ‡æ³¨
                    await this.loadSavedAnnotations();
                    
                } catch (error) {
                    console.error('Failed to load data:', error);
                    // å¦‚æœAPIä¸å¯ç”¨ï¼Œå›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®
                    this.data = Array.from({length: 10}, (_, i) => ({
                        id: `demo_${i}`,
                        originalImage: `https://via.placeholder.com/400x300/cccccc/666666?text=Original+${i}`,
                        imageA: `https://via.placeholder.com/400x300/ff6b6b/ffffff?text=Result+A+${i}`,
                        imageB: `https://via.placeholder.com/400x300/4ecdc4/ffffff?text=Result+B+${i}`,
                        englishPrompt: `Demo edit instruction ${i}: Add some elements to the image`,
                        chinesePrompt: `æ¼”ç¤ºç¼–è¾‘æŒ‡ä»¤ ${i}ï¼šåœ¨å›¾åƒä¸­æ·»åŠ ä¸€äº›å…ƒç´ `
                    }));
                    console.warn('Using demo data due to API unavailability');
                }
            }

            setupEventListeners() {
                // å¼€å§‹æ ‡æ³¨æŒ‰é’®
                document.getElementById('startAnnotationBtn').addEventListener('click', () => {
                    if (this.validateUserInfo()) {
                        this.collectUserInfo();
                        this.showGuidelines();
                    }
                });

                // éšè—æŒ‡å—æŒ‰é’®
                document.getElementById('hideGuidelinesBtn').addEventListener('click', () => {
                    this.hideGuidelines();
                    this.showCurrentItem();
                });

                // åå¥½é€‰æ‹©æŒ‰é’®
                document.querySelectorAll('.preference-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.preference-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        this.annotations[this.data[this.currentIndex].id] = btn.dataset.preference;
                        this.updateUI();
                    });
                });

                // å¯¼èˆªæŒ‰é’®
                document.getElementById('prevBtn').addEventListener('click', () => {
                    if (this.currentIndex > 0) {
                        this.currentIndex--;
                        this.showCurrentItem();
                    }
                });

                document.getElementById('nextBtn').addEventListener('click', () => {
                    if (this.currentIndex < this.data.length - 1) {
                        this.currentIndex++;
                        this.showCurrentItem();
                    }
                });

                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', (e) => {
                    // åªåœ¨æ ‡æ³¨ç•Œé¢æ¿€æ´»æ—¶ä½¿ç”¨å¿«æ·é”®
                    if (document.getElementById('annotationArea').style.display === 'none') return;
                    
                    if (e.key === 'ArrowLeft' && this.currentIndex > 0) {
                        this.currentIndex--;
                        this.showCurrentItem();
                    } else if (e.key === 'ArrowRight' && this.currentIndex < this.data.length - 1) {
                        this.currentIndex++;
                        this.showCurrentItem();
                    } else if (e.key >= '1' && e.key <= '6') {
                        const preferences = ['strong_a', 'strong_b', 'slight_a', 'slight_b', 'equal_good', 'equal_bad'];
                        const btn = document.querySelector(`[data-preference="${preferences[parseInt(e.key) - 1]}"]`);
                        if (btn) btn.click();
                    }
                });
            }

            showCurrentItem() {
                if (this.data.length === 0) return;

                const item = this.data[this.currentIndex];
                
                // æ›´æ–°å›¾ç‰‡
                document.getElementById('originalImage').src = item.originalImage;
                document.getElementById('imageA_img').src = item.imageA;
                document.getElementById('imageB_img').src = item.imageB;

                // æ›´æ–°æç¤ºæ–‡æœ¬
                document.getElementById('englishPrompt').textContent = item.englishPrompt;
                document.getElementById('chinesePrompt').textContent = item.chinesePrompt;

                // æ›´æ–°åå¥½é€‰æ‹©çŠ¶æ€
                document.querySelectorAll('.preference-btn').forEach(btn => btn.classList.remove('selected'));
                if (this.annotations[item.id]) {
                    const selectedBtn = document.querySelector(`[data-preference="${this.annotations[item.id]}"]`);
                    if (selectedBtn) selectedBtn.classList.add('selected');
                }

                this.updateUI();
                this.hideLoading();
            }

            updateUI() {
                // æ›´æ–°è¿›åº¦æ¡
                const progress = ((this.currentIndex + 1) / this.data.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';

                // æ›´æ–°å¯¼èˆªçŠ¶æ€
                document.getElementById('currentIndex').textContent = this.currentIndex + 1;
                document.getElementById('totalCount').textContent = this.data.length;

                document.getElementById('prevBtn').disabled = this.currentIndex === 0;
                document.getElementById('nextBtn').disabled = this.currentIndex === this.data.length - 1;

                // ä¿å­˜æ ‡æ³¨ç»“æœ
                this.saveAnnotations();
            }

            hideLoading() {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('annotationArea').style.display = 'grid';
                document.getElementById('navigationArea').style.display = 'flex';
            }

            showError(message) {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('errorDiv').style.display = 'block';
                document.getElementById('errorMessage').textContent = message;
            }

            async saveAnnotations() {
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('hq1k_annotations', JSON.stringify(this.annotations));
                
                // ä¿å­˜åˆ°æœåŠ¡å™¨ï¼ˆåŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼‰
                try {
                    const response = await fetch('/api/annotations', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            annotations: this.annotations,
                            user_info: this.userInfo
                        })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('æ ‡æ³¨ä¿å­˜æˆåŠŸ:', result.message);
                        console.log('ä¿å­˜è·¯å¾„:', result.file_path);
                    } else {
                        console.warn('Failed to save annotations to server');
                    }
                } catch (error) {
                    console.warn('Server not available, saved locally only');
                }
                
                console.log('å½“å‰æ ‡æ³¨è¿›åº¦:', Object.keys(this.annotations).length, '/', this.data.length);
            }

            async loadSavedAnnotations() {
                // å…ˆä»æœåŠ¡å™¨åŠ è½½
                try {
                    const response = await fetch('/api/annotations');
                    if (response.ok) {
                        this.annotations = await response.json();
                        return;
                    }
                } catch (error) {
                    console.warn('Failed to load annotations from server');
                }
                
                // å›é€€åˆ°æœ¬åœ°å­˜å‚¨
                const saved = localStorage.getItem('hq1k_annotations');
                if (saved) {
                    this.annotations = JSON.parse(saved);
                }
            }

            showUserInfoForm() {
                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('userInfoSection').style.display = 'block';
                
                // åŠ è½½å·²ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯
                const savedUserInfo = localStorage.getItem('hq1k_userInfo');
                if (savedUserInfo) {
                    const userInfo = JSON.parse(savedUserInfo);
                    document.getElementById('userName').value = userInfo.name || '';
                    document.getElementById('userAge').value = userInfo.age || '';
                    document.getElementById('userGender').value = userInfo.gender || '';
                    document.getElementById('userEducation').value = userInfo.education || '';
                    document.getElementById('userExperience').value = userInfo.experience || '';
                }
            }

            validateUserInfo() {
                const name = document.getElementById('userName').value.trim();
                const age = document.getElementById('userAge').value;
                const gender = document.getElementById('userGender').value;
                const education = document.getElementById('userEducation').value;
                const experience = document.getElementById('userExperience').value;

                if (!name) {
                    alert('è¯·è¾“å…¥æ‚¨çš„å§“å');
                    return false;
                }
                if (!age || age < 18 || age > 80) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„ï¼ˆ18-80å²ï¼‰');
                    return false;
                }
                if (!gender) {
                    alert('è¯·é€‰æ‹©æ€§åˆ«');
                    return false;
                }
                if (!education) {
                    alert('è¯·é€‰æ‹©æ•™è‚²èƒŒæ™¯');
                    return false;
                }
                if (!experience) {
                    alert('è¯·é€‰æ‹©å›¾åƒå¤„ç†ç»éªŒ');
                    return false;
                }

                return true;
            }

            collectUserInfo() {
                this.userInfo = {
                    name: document.getElementById('userName').value.trim(),
                    age: parseInt(document.getElementById('userAge').value),
                    gender: document.getElementById('userGender').value,
                    education: document.getElementById('userEducation').value,
                    experience: document.getElementById('userExperience').value,
                    timestamp: new Date().toISOString()
                };

                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('hq1k_userInfo', JSON.stringify(this.userInfo));
                
                // ä¿å­˜åˆ°æœåŠ¡å™¨
                this.saveUserInfoToServer();
                console.log('User info collected:', this.userInfo);
            }

            showGuidelines() {
                document.getElementById('userInfoSection').style.display = 'none';
                document.getElementById('guidelinesSection').style.display = 'block';
            }

            hideGuidelines() {
                document.getElementById('guidelinesSection').style.display = 'none';
                document.getElementById('progressSection').style.display = 'block';
                document.getElementById('annotationArea').style.display = 'grid';
                document.getElementById('navigationArea').style.display = 'flex';
            }

            async saveUserInfoToServer() {
                try {
                    const response = await fetch('/api/user-info', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(this.userInfo)
                    });
                    
                    if (!response.ok) {
                        console.warn('Failed to save user info to server');
                    }
                } catch (error) {
                    console.warn('Server not available, user info saved locally only');
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            new AnnotationInterface();
        });
    </script>
</body>
</html>
